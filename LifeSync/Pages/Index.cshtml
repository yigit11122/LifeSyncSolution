@page
@model LifeSync.Pages.IndexModel
@{
    ViewData["Title"] = "LifeSync Dashboard";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeSync Dashboard</title>
    <link rel="stylesheet" href="/css/site.css">
</head>
<body>
    <h1>LifeSync Dashboard</h1>

    <div class="integration-section">
        <h2>Todoist Görevlerim</h2>
        <button id="connect-todoist">Connect with Todoist</button>
        <div id="todoist-list"></div>
    </div>

    <div class="integration-section">
        <h2>Google Takvim Etkinliklerim</h2>
        <button id="connect-google">Connect with Google Calendar</button>
        <div id="googleCalendar-list"></div>
    </div>

    <div class="integration-section">
        <h2>Notion Sayfalarım</h2>
        <button id="connect-notion">Connect with Notion</button>
        <div id="notion-list"></div>
    </div>

    <div class="integration-section">
        <h2>Fitbit Aktivitelerim</h2>
        <button id="connect-fitbit">Connect with Fitbit</button>
        <div id="fitbit-list"></div>
    </div>

    <div class="integration-section">
        <h2>LifeSync Verilerim</h2>
        <button id="fetch-lifesync">Fetch LifeSync Data</button>
        <div id="lifesync-list"></div>
    </div>

    <script src="/js/site.js"></script>
    <script src="/js/todoist.js"></script>
    <script src="/js/googleCalendar.js"></script>
    <script src="/js/notion.js"></script>
    <script src="/js/fitbit.js"></script>
    <script src="/js/lifesync.js"></script>

    <script>
        // Butonlara tıklama olaylarını ekle ve hata kontrolü yap
        const buttons = [
            { id: 'connect-todoist', func: 'initiateTodoistOAuth' },
            { id: 'connect-google', func: 'initiateGoogleCalendarOAuth' },
            { id: 'connect-notion', func: 'initiateNotionOAuth' },
            { id: 'connect-fitbit', func: 'initiateFitbitOAuth' },
            { id: 'fetch-lifesync', func: 'startLifeSyncPolling' }
        ];

        buttons.forEach(btn => {
            const button = document.getElementById(btn.id);
            if (button) {
                button.addEventListener('click', () => {
                    if (typeof window[btn.func] === 'function') {
                        window[btn.func]();
                        console.log(`${btn.id} butonu tıklandı, ${btn.func} fonksiyonu çalıştırıldı.`);
                    } else {
                        console.error(`${btn.id} butonu için ${btn.func} fonksiyonu tanımlı değil.`);
                    }
                });
                console.log(`${btn.id} butonu tıklanabilir hale getirildi.`);
            } else {
                console.error(`${btn.id} butonu bulunamadı.`);
            }
        });

        // Sayfa yüklendiğinde verileri çek
        window.onload = async () => {
            try {
                const sources = ['todoist', 'googleCalendar', 'notion', 'fitbit', 'lifesync'];
                for (const source of sources) {
                    console.log(`${source} için veri çekme denemesi yapılıyor...`);
                    const data = await fetchDataFromBackend(source);
                    if (data && Array.isArray(data) && data.length > 0) {
                        displayData(data, source);
                        console.log(`${source} verileri başarıyla çekildi ve görüntülendi.`);
                    } else if (data) {
                        console.log(`${source} için veri boş veya geçersiz:`, data);
                    } else {
                        console.log(`${source} için veri çekilemedi.`);
                    }
                }
            } catch (error) {
                console.error('Genel veri çekme hatası:', error);
            }
        };
    </script>
</body>
</html>