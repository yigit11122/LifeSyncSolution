@page
@model LifeSync.Pages.IndexModel
@{
    ViewData["Title"] = "LifeSync";
}

<div class="layout">
    <aside class="sidebar">
        <div class="logo">🧠 LifeSync</div>
        <nav>
            <a href="/Index">📋 Ana Sayfa</a>
            <a href="/Privacy">🔒 Gizlilik</a>
            <a href="#">⚙️ Ayarlar</a>
        </nav>
    </aside>

    <main class="content">
        <h1>Hoş Geldin 👋</h1>
        <p class="subtitle">Günlük görevlerini ve notlarını buradan yönetebilirsin.</p>

        <div class="card-grid">
            <div class="card">
                <h2>Todoist</h2>
                <ul id="todoist-list"></ul>
                <button id="connect-todoist">🔗 Bağlan</button>
            </div>

            <div class="card">
                <h2>Notion</h2>
                <ul id="notion-list"></ul>
                <button id="connect-notion">🔗 Bağlan</button>
            </div>

            <div class="card">
                <h2>Notlarım</h2>
                <ul id="lifesync-list"></ul>
                <textarea id="lifesync-input" maxlength="200" placeholder="Yeni not yaz..."></textarea>
                <div class="note-footer">
                    <span id="char-count">0/200</span>
                    <button id="lifesync-submit">➕ Ekle</button>
                </div>
            </div>
        </div>
    </main>
</div>

@section Scripts {
    <script>
        window.FETCH_INTERVAL = 60000;

        document.addEventListener("DOMContentLoaded", () => {
            const sources = ['todoist', 'notion', 'lifesync'];

            for (const source of sources) {
                fetch(`/Index?handler=FetchData&source=${source}`)
                    .then(res => res.json())
                    .then(data => {
                        const limited = data.slice(0, 2); // sadece ilk 2 içerik göster
                        displayData(limited, source);
                    })
                    .catch(err => console.error(`${source} veri çekme hatası:`, err));
            }

            const input = document.getElementById("lifesync-input");
            const count = document.getElementById("char-count");
            input.addEventListener("input", () => {
                count.innerText = `${input.value.length}/200`;
            });
        });
    </script>

    <script src="/js/site.js"></script>
    <script src="/js/lifeSync.js"></script>
    <script src="/js/todoist.js"></script>
    <script src="/js/notion.js"></script>
}
